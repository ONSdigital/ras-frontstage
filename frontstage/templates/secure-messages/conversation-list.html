{% import 'partials/section.html' as section %}
{% extends "layouts/_onecol.html" %}

{% block page_title %}Messages - ONS Business Surveys{% endblock %}

{% block main %}

{% include 'partials/tab_list.html' %}

<div role="main" id="main" class="page__main">
  <div class="container">
    {% if new_message %}
        <div class="panel panel--simple panel--success">
            <div id="message-success-notif" class="panel__body">
                <p>
                    Message sent
                </p>
            </div>
        </div>
    {% endif %}
    {% if not messages %}
      <p>No new messages</p>
    {% else %}

      <ul class="message-list col-9@m">
        {% for message in messages %}
          {% if message['unread'] %}
            <li id="message-list-unread" class="message-list__item venus">
              <a href="{{ url_for('secure_message_bp.view_conversation', thread_id=message.thread_id) }}#latest-message" id="message-link-{{ loop.index }}">{{ message.subject }}</a>
              <span class="secure-message-conversation-meta__label mercury" style="color: #666;"> (New) </span>
          {% else %}
            <li id="message-list" class="message-list__item mars">
            <a href="{{ url_for('secure_message_bp.view_conversation', thread_id=message.thread_id) }}#latest-message" id="message-link-{{ loop.index }}">{{ message.subject }}</a>
          {% endif %}

            <div class="message-details">
              <div class="secure-message-sent-message-meta-from mars">
                <span class="tempHack u-vh">From: </span>
                ONS Business Surveys Team
              </div>

              <div class="secure-message-sent-message-meta-datetime mars u-mb-s" style="display: block; color: #666;">
                <span class="tempHack u-vh">Sent: </span>
                {{ message.sent_date or 'Unavailable' }}
              </div>
            </div>

            <p class="message-list__item-preview">{{ message['body']|truncate(80, False, '...', 0) }}</p>

            <p class="message-list__item-preview--link">
              <a href="{{ url_for('secure_message_bp.view_conversation', thread_id=message.thread_id) }}#latest-message" id="open-conversation-link-{{ loop.index }}">Read full message</a>
            </p>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
{% endblock main %}
