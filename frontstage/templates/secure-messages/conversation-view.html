{% extends "secure-messages/messages.html" %}

{% block page_title %}View message - ONS Business Surveys{% endblock %}

{% block messages %}

{% if form.errors %}
    <div class="panel panel--error col-7@m">
        <div class="panel__header">
            {% if form.errors|length > 1 %}
                <h1 class="panel__title venus">This page has {{ form.errors|length }} errors</h1>
            {% elif form.errors %}
                <h1 class="panel__title venus">This page has {{ form.errors|length }} error</h1>
            {% endif %}
        </div>
        <div class="panel__body">
            <ol>
              {% for field in form.errors %}
                {% for error in form.errors[field] %}
                  <li class="panel__title venus"><a>{{ error }}</a></li>
                {% endfor %}
              {% endfor %}
              {% if form.body.errors %}
                {% for error in form.body.errors %}
                  <li class="panel__title venus"><a href='#secure-message-body'>{{ error }}</a></li>
                {% endfor %}
              {% endif %}
            </ol>
        </div>
    </div>
<br />
{% endif %}

<div class="secure-message-view-component">
    {% for message in conversation %}
       <div class="secure-message-sent-message">
    {% if message.get('internal') == True %}
        <div name="sm-from-ons" id="sm-from-ons-{{ loop.index }}">
    {% else %}
        <div name="sm-from-respondent" id="sm-from-respondent-{{ loop.index }}">
    {% endif %}
            {% if loop.last %}<div name="latest-message"   id='latest-message' ></div>{% endif %}
            <span>
                From:
                <span name="sm-from-user" id="sm-from-user-{{ loop.index }}">{{ message.get('username') }}</span>
            </span>
            <span>
                Sent:
                <span name="sm-sent-date" id="sm-sent-date-{{ loop.index }}">{{ message.get('sent_date') }}</span>

            </span>
        </div>
        <div>
            <span style="white-space:pre-line">{{ message.get('body') }}</span>
        </div>
    </div>
    {% endfor %}

    <form action="{{ url_for('secure_message_bp.view_conversation', thread_id=conversation[0].thread_id) }}" method="post", id="create-message-form">
      {{ form.csrf_token }}
      {{ form.body(id='secure-message-body', class_='input input--textarea input--textarea-message', rows='10') }}
      </br>
      <input class="btn" id="send-message-btn" name="send" type="submit" value="Send" />
    </form>

    <p><a href="{{ url_for('secure_message_bp.messages_get') }}">Cancel</a></p>

</div>

{% endblock messages %}
