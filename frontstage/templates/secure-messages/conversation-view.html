{% extends "secure-messages/messages.html" %}
{% block page_title %}View message - ONS Business Surveys{% endblock %}
{% set subject = conversation[-1]["subject"] or "No Subject" %}

{% block messages %}

{% if form.errors %}
    <div class="panel panel--error col-7@m">
        <div class="panel__header">
            {% if form.errors|length > 1 %}
                <h1 class="panel__title venus">This page has {{ form.errors|length }} errors</h1>
            {% elif form.errors %}
                <h1 class="panel__title venus">This page has {{ form.errors|length }} error</h1>
            {% endif %}
        </div>
        <div class="panel__body">
            <ol>
              {% if form.body.errors %}
                {% for error in form.body.errors %}
                  <li class="panel__title venus"><a href='#secure-message-body'>{{ error }}</a></li>
                {% endfor %}
              {% endif %}
            </ol>
        </div>
    </div>
<br />
{% endif %}

<h1 class="saturn" name="page-messages-title" style="padding-bottom:5px">{{ subject }}</h1>
<div class="secure-message-view-component">
    {% for message in conversation %}
      <div class="secure-message-sent-message" id="sm-from-ons-{{ loop.index }}">
        {% if loop.last %}<div name="latest-message" id='latest-message'></div>{% endif %}
        <span class="secure-message-sent-message-meta-from venus">
            <span name="sm-from-user" id="sm-from-user-{{ loop.index }}" >{{ message.get('from') }}</span>
        </span>
        <span class="secure-message-sent-message-meta-datetime mercury">
            <span name="sm-sent-date" id="sm-sent-date-{{ loop.index }}">{{ message.get('sent_date') }}</span>
        </span>
        <span class="secure-message-sent-message-body">{{ message.get('body') }}</span>
    </div>
     {% if not loop.last %}
           <hr>
        {% endif %}
    {% endfor %}
</div>
<div class="secure-message-reply">
    <form action="{{ url_for('secure_message_bp.view_conversation', thread_id=conversation[0].thread_id) }}" method="post" id="create-message-form">
        <label class="venus" for="message-text">Reply</label>
        {{ form.csrf_token }}
        {{ form.body(id='secure-message-body', class_='input input--textarea input--textarea-message', rows='10') }}
        </br>
        <input class="btn" id="send-message-btn" name="send" type="submit" value="Send" />
    </form>

    <p><a href="{{ url_for('secure_message_bp.view_conversation_list') }}">Cancel</a></p>
</div>
{% endblock messages %}
