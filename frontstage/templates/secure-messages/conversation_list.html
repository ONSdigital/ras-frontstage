{% import 'partials/section.html' as section %}
{% extends "layouts/_onecol.html" %}

{% block page_title %}Messages - ONS Business Surveys{% endblock %}

{% block main %}

{% include 'partials/tab_list.html' %}

<div role="main" id="main" class="page__main">
  <div class="container">
    {% if not messages %}
      <p>No new messages</p>
    {% else %}

      <ul class="message-list">
        {% for message in messages %}
          <li id="message-list" class="message-list__item">
            <a href="{{ url_for('secure_message_bp.view_conversation', thread_id=message.thread_id) }}#latest-message" id="message-link-{{ loop.index }}">{{ message.subject }}</a>

            <dl class="grid">
              <dt class="grid__col col-2@m">
                  From:
              </dt>

              <dd class="grid__col col-9@m pull-1@m">
                  {{ message.from or 'Unavailable' }}
              </dd>
            </dl>

            <dl class="grid">
              <dt class="grid__col col-2@m">
                  Sent date:
              </dt>

              <dd class="grid__col col-9@m pull-1@m">
                  {{ message.sent_date or 'Unavailable' }}
              </dd>
            </dl>

            <p>{{ message['body']|truncate(100) }}</p>

            <a href="{{ url_for('secure_message_bp.view_conversation', thread_id=message.thread_id) }}#latest-message" id="open-conversation-link-{{ loop.index }}">View conversation</a>

          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
{% endblock main %}
