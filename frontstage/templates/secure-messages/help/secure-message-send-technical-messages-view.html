{% extends "layouts/_block_content.html" %}
{% from "components/breadcrumbs/_macro.njk" import onsBreadcrumbs %}
{% from "components/button/_macro.njk" import onsButton %}
{% from "components/lists/_macro.njk" import onsList %}
{% from "components/panel/_macro.njk" import onsPanel %}
{% from "components/textarea/_macro.njk" import onsTextarea %}

{% set page_title = "Send a technical message" %}
{% block breadcrumbs %}
    {{
        onsBreadcrumbs({
            "ariaLabel": "Breadcrumbs",
            "id": "breadcrumbs",
            "itemsList": breadcrumbs
        })
    }}
{% endblock breadcrumbs %}

{% block main %}
    {% set ns = namespace(bodyError = false) %}
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                {% set errorTitle = 'There is 1 error on this page' %}
                {% set ns.bodyError = true %}
                {% set ns.errorMessage = message %}
                    {% call
                        onsPanel({
                            "type": "error",
                            "classes": "u-mb-s",
                            "title":  errorTitle
                        })
                    %}
                    {{
                        onsList({
                            "element": "ol",
                            "itemsList": [
                            {
                                "text": message,
                                "url": "#secure-message-body_error",
                                "classes": "js-inpagelink"
                            }
                            ]
                        })
                    }}
                    {% endcall %}
            {% endfor %}
        {% endif %}
    {% endwith %}
    <h1>Send a message</h1>
    <p>Describe your issue and we will get back to you.</p>
    <dl class="metadata metadata__list grid grid--gutterless u-cf u-mb-l" title="Message subject" aria-label="Message subject">
        <dt class="metadata__term grid__col col-2@m">Subject:</dt>
        <dd class="metadata__value grid__col col-10@m">{{ subject }}</dd>
    </dl>
    <div class="secure-message-form col-10@m" id="secure-message-form">
        <form action="{{ url_for('surveys_bp.send_help_technical_message', option=option) }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                {% if ns.bodyError %}
                    {% set error = { "text": ns.errorMessage,  "id": 'secure-message-body_error' } %}
                {% endif %}

                {{
                    onsTextarea({
                        "id": "secure-message-body",
                        "name": "body",
                        "label": {
                            "text": "Enter message",
                        },
                        "charCheckLimit": false,
                        "error": error,
                    })
                }}

            <div class="grid grid--flex grid--gutterless grid--vertical-center grid--no-wrap@s u-mt-m u-mb-m">
                <div class="grid__col">
                    {{
                        onsButton({
                        "text": "Send message",
                        "id": "send-message-btn",
                        "classes": 'btn btn-group__btn',
                        "submitType": "timer",
                        })
                    }}
                </div>
                <div class="grid__col u-ml-m">
                        <a href="{{ url_for('surveys_bp.get_technical_message_page_option', option=option)}}"
                    id="btn-sub-option-cancel">Cancel</a>
                </div>
            </div>
        </form>
    </div>
{% endblock main %}
