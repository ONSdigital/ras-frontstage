{% from "components/button/_macro.njk" import onsButton %}
{% from "components/table/_macro.njk" import onsTable %}

{% set surveyTableData = {
    "table_class": 'table--responsive',
    "id": 'tbl-surveys'
}
%}

{% set surveyTableDataRows = [] %}
{% for survey in sorted_surveys_list %}
    {% set surveyContent %}
            <h1 class="u-mb-xs u-fs-m u-mt-s u-mb-s">
                <a href="{{ url_for('surveys_bp.access_survey', case_id=survey.case_id, ci_type = survey.collection_instrument_type, business_party_id=survey.business_party_id, survey_short_name=survey.survey_short_name) }}" aria-label="Access the {{ survey.survey_long_name }}">{{ survey.survey_long_name }}</a>
            </h1>
            <dl class="grid">
                <div class="grid__col col-5@m u-pt-no u-pb-no">
                    <dt class="u-ml-no u-mb-xs u-pr-xs u-fs-s">Period covered: {{ survey.period }}</dt>
                    <dt class="u-ml-no u-mb-xs u-pr-xs u-fs-s">Business: {{ survey.business_name }}</dt>
                    <dt class="u-ml-no u-mb-xs u-pr-xs u-fs-s">RU ref: {{ survey.business_ref }}</dt>
                </div>
                <div class="grid__col col-4@m u-pt-no u-pb-no">
                    <dt class="u-fs-r u-ml-no u-mb-xs" style="line-height:1">
                        <strong>{{ survey.due_in }}</strong>
                    </dt>
                    <dt class="u-ml-no u-mb-xs u-pr-xs u-fs-s">Submit by: {{ survey.formatted_submit_by }}</dt>
                </div>
                {% if survey.status == 'Not started' %}
                    {% set status_class = 'status--dead' %}
                {% elif survey.status == 'Downloaded' or survey.status == 'In progress' %}
                    {% set status_class = 'status--success' %}
                {% else %}
                    {% set status_class = 'status--error' %}
                {% endif %}
                <div class="grid__col col-3@m u-pt-no u-pb-no">
                          <dt class="u-vh">Status</dt>
                          <dd class="u-fs-r u-ml-no u-mb-xs">
                            <span class="status {{ status_class }}">{{ survey.status }}</span>
                          </dd>
                          <dt class="u-vh">Help</dt>
                          <dd class="u-ml-no u-mb-m">
                              <a id="create-message-link-{{loop.index}}" href="{{ url_for('surveys_bp.get_help_page', short_name=survey.survey_short_name, business_id=survey.business_party_id) }}">Get help with this survey <span class="u-vh"> about {{ survey.survey_long_name }}</span></a>
                          </dd>
                </div>
            </dl>
    {% endset %}
    {% do surveyTableDataRows.append(
        {
        "highlight": true if survey.added_survey,
        "tds": [
            {
                "value": surveyContent,
                "data": "Survey",
                "id": "new-survey" if survey.added_survey
            }
        ]
        }
    ) %}
{% endfor %}

{% do surveyTableData | setAttribute("trs", surveyTableDataRows) %}
{{
    onsTable(surveyTableData)
}}

{% if sorted_surveys_list|length == 0 %}
    {{ emptySurveyListLabel }}
{% endif %}
